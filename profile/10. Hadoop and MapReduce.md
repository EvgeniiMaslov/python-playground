

[**MapReduce**](#MapReduce)

* [Example: Counting Words](#Example: Counting Words)





## MapReduce



Imagine we have a collection of items we’d like to process somehow. For instance, the items might be website logs, the texts of various books, image files, or anything else. A basic version of the MapReduce algorithm consists of the following steps: 

1. Use a mapper function to turn each item into zero or more key/value pairs. (Often this is called the map function, but there is already a Python function called map and we don’t need to confuse the two.) 
2. Collect together all the pairs with identical keys. 
3. Use a reducer function on each collection of grouped values to produce output values for the corresponding key.

### Example: Counting Words

For example, your VP of Content wants to know what sorts of things people are talking about in their status updates. First, we need a function that turns a document into a sequence of key/value pairs. We’ll want our output to be grouped by word, which means that the keys should be words. And for each word, we’ll just emit the value 1 to indicate that this pair corresponds to one occurrence of the word:

```python
from typing import Iterator, Tuple
def wc_mapper(document: str) -> Iterator[Tuple[str, int]]:
 """For each word in the document, emit (word, 1)"""
 for word in tokenize(document):
 yield (word, 1)
```

Skipping the “plumbing” step 2 for the moment, imagine that for some word we’ve collected a list of the corresponding counts we emitted. To produce the overall count for that word, then, we just need:

```python
from typing import Iterable
def wc_reducer(word: str,
               counts: Iterable[int]) -> Iterator[Tuple[str, int]]:
 """Sum up the counts for a word"""
 yield (word, sum(counts))
```

Returning to step 2, we now need to collect the results from wc_mapper and feed them to wc_reducer. Let’s think about how we would do this on just one computer:

```python
from collections import defaultdict
def word_count(documents: List[str]) -> List[Tuple[str, int]]:
 """Count the words in the input documents using MapReduce"""
 collector = defaultdict(list) # To store grouped values
 for document in documents:
 	for word, count in wc_mapper(document):
 		collector[word].append(count)
 return [output
         for word, counts in collector.items()
         for output in wc_reducer(word, counts)]
```





